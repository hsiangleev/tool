<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        html{
            touch-action:pan-y;
        }
            .urp-scroll{
                width: 300px;
                height: 400px;
                outline: 1px solid #ccc;
                margin: 30px auto;
                overflow: hidden;
                padding-right: 5px;
                position: relative;
            }
            .urp-scrollBar{
                width: 5px;
                height: 100%;
                position: absolute;
                right: 0;
                top: 0;
            }
            .urp-scrollBar-body{
                width: 100%;
                height: 30%;
                border-radius: 7px;
                position: absolute;
                top: 0px;
            }
        </style>
</head>

<body>
        <div>
                <div class="scroll">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, tenetur nesciunt! Voluptates, qui ipsam tempora laboriosam ea odio nihil. Eligendi, quia dolore at nesciunt repellendus ipsam tempore dolorem facilis amet quas incidunt. Eveniet unde, ipsam porro nihil rem, expedita accusantium repellat beatae a maiores itaque reprehenderit veniam quisquam sit. Ea, expedita. Ea nihil deserunt saepe culpa cumque quia voluptatibus consectetur laboriosam? Laboriosam sit perferendis reprehenderit quis officia ab nulla quidem, non est amet ipsa iste veritatis alias cum sint voluptatibus perspiciatis dicta quisquam quasi adipisci! Modi ullam temporibus aliquam quod a nemo sed, dolores excepturi itaque quisquam repellendus velit. Nesciunt quae error totam ut sapiente reiciendis natus deserunt architecto, rem ab nam repudiandae expedita cum laudantium. Distinctio repudiandae, voluptate cupiditate nemo assumenda reiciendis, amet veniam nisi corrupti quam placeat harum repellat eos obcaecati molestias? Minima doloremque earum atque placeat perferendis libero ad fugit perspiciatis dolorem, modi adipisci aperiam deserunt veniam accusantium quia aut assumenda nisi eaque aspernatur expedita hic vel. Amet, recusandae! Rem, necessitatibus voluptatum. Nulla omnis reiciendis ad blanditiis a alias commodi odit veniam! Necessitatibus, illo totam inventore alias consequuntur dolores corporis temporibus at veniam iste fugit fugiat saepe velit iusto, repellat fuga non eligendi. Quidem aspernatur tempora perspiciatis architecto saepe a commodi placeat inventore optio sint accusamus ipsam consectetur, incidunt iste asperiores. Doloribus illum quasi debitis magni ex in, molestias provident qui quis cum? Ipsam qui magni rem veritatis est quod laboriosam perspiciatis libero voluptate minus cumque porro, quisquam dolor suscipit quae neque doloremque labore nulla nihil sit quibusdam ipsa esse architecto. Commodi amet quis deserunt cum omnis id voluptate nihil, ipsa qui, corrupti dolores cumque, nulla non consectetur deleniti sit. Aperiam doloribus, quas amet nisi reiciendis libero adipisci magnam. Suscipit quae dolorem sapiente, dolor, porro aliquam laudantium numquam asperiores veritatis accusamus autem minima ad. Maxime, eaque recusandae!
                </div>
            </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
    function ScrollBar(options) {
        this.options=options;     // 获取传入的数据
        this.contentEL=$(options.el);
        this.wrapEl="";
        this.rate=0;
        this.scrollBarBodyHeight=0;
        this.maxCurrent=0;
        this.y=0;
        this.pageY=0;
        this.current=0;

        this.scrollBarEL="";
        this.scrollBarBodyEL="";

        this.color=this.options.color || "#aaa";
        this.width=this.options.width || "5px";

        this.init();
    }

    ScrollBar.prototype={
        constructor: ScrollBar,
        init: function () {
            this.wrapEl=this.contentEL.parent().addClass("urp-scroll").append(
                '<div class="urp-scrollBar" style="width: '+this.width+'">'+
                    '<div class="urp-scrollBar-body" style="background-color: '+this.color+';"></div>'+
                '</div>'
            );
            this.contentEL.css("padding-right",this.width);
            this.scrollBarEL=this.wrapEl.children(".urp-scrollBar");
            this.scrollBarBodyEL=this.scrollBarEL.children(".urp-scrollBar-body");
            this.countHeight();
            this.event();
        },
        countHeight: function() {
            this.rate=this.wrapEl.height()/this.contentEL.height();
            if(this.rate>1){
                this.rate=1;
                this.scrollBarEL.css("opacity",0);
            }else{
                this.scrollBarEL.css("opacity",1);
            }
            this.scrollBarBodyHeight=this.scrollBarEL.height()*this.rate;
            this.scrollBarBodyEL.css("height",this.scrollBarBodyHeight);

            this.maxCurrent=this.scrollBarEL.height()-this.scrollBarBodyHeight;
            
            this.current=this.current>this.maxCurrent ? this.maxCurrent : this.current;
            this.scrollFn();
        },
        scrollFn: function() {
            if(this.current<0){
                this.current=0;
            }
            if(this.current>this.maxCurrent) {
                this.current=this.maxCurrent;
            }
            this.scrollBarBodyEL.css("top",this.current+"px");
            this.wrapEl.scrollTop(this.current/this.rate);
            this.scrollBarEL.css("top",this.current/this.rate+"px");
        },
        down: function(type, e) {
            var clientY=0,moveType,endType;
            if(type==="mouse"){
                this.y=e.clientY-this.wrapEl.offset().top-this.scrollBarBodyEL.position().top;
                moveType="mousemove";
                endType="mouseup";
            }else if(type==="touch"){
                e.preventDefault();
                this.y=e.originalEvent.touches[0].clientY-this.wrapEl.offset().top-this.scrollBarBodyEL.position().top;
                moveType="touchmove";
                endType="touchend";
            }else{
                e.preventDefault();
                this.pageY=e.originalEvent.touches[0].pageY;
                moveType="touchmove";
                endType="touchend";
            }
            var scrollFn = this.throttle(this.move.bind(this,type));
            $(document).on(moveType+".move", scrollFn);
            $(document).on(endType+".up", function() {
                $(document).off(".move").off(".up");
            })
        },
        move: function(type, e) {
            var clientY=0;
            if(type==="mouse"){
                this.current=e.clientY-this.y-this.wrapEl.offset().top;
            }else if(type==="touch"){
                this.current=e.originalEvent.touches[0].clientY-this.y-this.wrapEl.offset().top;
            }else{
                this.current=this.current-(e.originalEvent.touches[0].pageY-this.pageY)/10;
            }
            this.scrollFn();
            window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty();
        },
        event: function() {
            var that=this;
            this.scrollBarBodyEL.on("mousedown", this.down.bind(this,"mouse"));
            this.scrollBarBodyEL.on("touchstart", this.down.bind(this,"touch"));
            this.contentEL.on("touchstart", this.down.bind(this,"contentTouch"));
            this.scrollBarBodyEL.on("click", function(e) {
                e.stopPropagation();
            });
            this.scrollBarEL.on("click", function(e) {
                var y=e.clientY-that.wrapEl.offset().top;
                // 判断点击的是上面还是下面
                if(y>that.current){
                    that.current+=that.scrollBarBodyHeight;
                }else{
                    that.current-=that.scrollBarBodyHeight;
                }
                that.scrollFn();
            })
            this.wrapEl.on("mousewheel DOMMouseScroll", function(e) {
                var value = e.originalEvent.wheelDelta || -e.originalEvent.detail;
                that.current=value>0 ? that.current-15 : that.current+15;
                that.scrollFn();
            })
            var scrollFn = this.throttle(function() {
                that.countHeight();
            });
            $(window).on("resize", scrollFn);
        },
        // 节流函数
        throttle: function (callback, time) {
            var timer = null;
            var firstTime = true;
            return function () {
                var args = arguments;
                var _self = this;
                if (firstTime) {
                    callback.apply(_self, args);
                    return firstTime = false;
                }
                if (timer) {
                    return false;
                }
                timer = setTimeout(function () {
                    clearTimeout(timer);
                    timer = null;
                    callback.apply(_self, args);
                }, time || 50)
    
            }
        }
    }    
        new ScrollBar({
                el: ".scroll",
                color: "#888",
                width: "7px"
            })
    </script>
</body>

</html>